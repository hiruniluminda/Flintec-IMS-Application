<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="au theme template">
    <meta name="author" content="Hau Nguyen">
    <meta name="keywords" content="au theme template">

    <!-- Fontfaces CSS-->
    <link href="~/Content/font-face.css" rel="stylesheet" />

    <link href="~/Content/fontawesome-all.min.css" rel="stylesheet" />
    <link href="~/Content/material-design-iconic-font.min.css" rel="stylesheet" />

    <!-- Bootstrap CSS-->

    <link href="~/Content/Manager/bootstrap.min.css" rel="stylesheet" />

    <link href="~/Content/animsition.min.css" rel="stylesheet" />
    <link href="~/Content/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet" />
    <link href="~/Content/animate.css" rel="stylesheet" />
    <link href="~/Content/hamburgers.min.css" rel="stylesheet" />
    <link href="~/Content/slick.css" rel="stylesheet" />
    <link href="~/Content/adminstyles/select2-min.css" rel="stylesheet" />
    <link href="~/Content/perfect-scrollbar.css" rel="stylesheet" />
    <link href="~/Content/material-design-iconic-font.min.css" rel="stylesheet" />
    <!-- Main CSS-->
    <link href="~/Content/theme.css" rel="stylesheet" />
    <link href="~/Content/fontawesome.css" rel="stylesheet" />
    <link href="~/Content/css/all.css" rel="stylesheet" />

</head>


<body class="animsition">
    <div class="page-wrapper">
        <!-- HEADER DESKTOP-->
        <header class="header-desktop3 d-none d-lg-block" style="background-color:#222">
            <div class="section__content section__content--p35">
                <div class="header3-wrap">
                    <div class="header__logo">
                        <a href="#">
                            <img src="~/Content/images/logo.png" style="border-radius: 10px;" alt="CoolAdmin" />
                        </a>
                    </div>
                    <div class="header__navbar">
                        <ul class="list-unstyled">
                            <li class="has-sub">
                                <a href="@Url.Action("DashBord", "CellEngineer")?lineid=@ViewBag.lineId">
                                    <i class="fas fa-tachometer-alt"></i>Dashboard
                                    <span class="bot-line"></span>
                                </a>

                            </li>
                            <li class="has-sub">
                                <a href="@Url.Action("NotificationsManagement", "CellEngineer")?lineid=@ViewBag.lineId">
                                    <i class="fas fa-tachometer-alt"></i>Notification Management
                                    <span class="bot-line"></span>
                                </a>
                            </li>

                            <li class="has-sub">
                                <a href="#">
                                    <i class="fas fa-copy"></i>
                                    <span class="bot-line"></span>New Issue
                                </a>
                                <ul class="header3-sub-list list-unstyled">
                                    @*<li>
                                        <a href="@Url.Action("MachinBreakdown", "CellEngineer")?lineid=@ViewBag.lineId">Machine Breakdown</a>
                                    </li>*@
                                    <li>
                                        <a href="@Url.Action("TechnicalIssue", "CellEngineer")?lineid=@ViewBag.lineId">Technical Issue</a>
                                    </li>
                                    <li>
                                        <a href="@Url.Action("MaterialDelay", "CellEngineer")?lineid=@ViewBag.lineId">Material Delay</a>
                                    </li>
                                    <li id="it_drop">
                                        <a href="@Url.Action("ITIssue", "CellEngineer")?lineid=@ViewBag.lineId">Software/IT Issue</a>
                                    </li>
                                    <li id="qulity_drop">
                                        <a href="@Url.Action("QualityIssue", "CellEngineer")?lineid=@ViewBag.lineId">Quality Issue</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="has-sub" id="switch">
                                <a href="#">
                                    <i class="fas fa-exchange-alt"></i>Switch Lines
                                    <span class="bot-line"></span>
                                </a>
                                <ul class="header3-sub-list list-unstyled"></ul>
                            </li>
                            
                        </ul>
                    </div>
                    <div class="header__tool">
                        <div class="header-button-item has-noti js-item-menu">

                            <i class="zmdi zmdi-notifications"></i>
                            <span class="badge" style="color:white;font-size:initial;font-family:'Bodoni MT'" id="ntCnt"></span>
                            <div class="notifi-dropdown notifi-dropdown--no-bor js-dropdown" id="divNotificaion">

                            </div>
                        </div>

                        <div class="account-wrap">
                            <div class="account-item account-item--style2 clearfix js-item-menu">
                                <div class="image">
                                    <img src="~/Content/images/profile.jpg" alt="John Doe" />
                                </div>
                                <div class="content">
                                    <a class="js-acc-btn" href="#">@Session["name"]</a>
                                </div>
                                <div class="account-dropdown js-dropdown">
                                    <div class="info clearfix">
                                        <div class="image">
                                            <a href="#">
                                                <img src="~/Content/images/profile.jpg" alt="John Doe" />
                                            </a>
                                        </div>
                                        <div class="content">
                                            <h5 class="name">
                                                <a href="#">@Session["name"]</a>
                                            </h5>
                                            <span class="email">@Session["email"]</span>
                                        </div>
                                    </div>

                                    <div class="account-dropdown__footer">
                                        <a href="@Url.Action("LogOut","Login")">
                                            <i class="zmdi zmdi-power"></i>Logout
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- END HEADER DESKTOP-->
        <!-- HEADER MOBILE-->
        <header class="header-mobile header-mobile-2 d-block d-lg-none" style="background-color:#222">
            <div class="header-mobile__bar">
                <div class="container-fluid">
                    <div class="header-mobile-inner">
                        <a class="logo" href="index.html">
                            <img src="~/Content/images/logo.png" alt="CoolAdmin" />
                        </a>
                        <button class="hamburger hamburger--slider" type="button">
                            <span class="hamburger-box">
                                <span class="hamburger-inner"></span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
            <nav class="navbar-mobile">
                <div class="container-fluid">
                    <ul class="navbar-mobile__list list-unstyled">
                        <li class="has-sub">
                            <a class="js-arrow" href="@Url.Action("DashBord", "CellEngineer")?lineid=@ViewBag.lineId">
                                <i class="fas fa-tachometer-alt"></i>Dashboard
                            </a>

                        </li>
                        <li class="has-sub">
                            <a class="js-arrow" href="@Url.Action("NotificationsManagement", "CellEngineer")?lineid=@ViewBag.lineId">
                                <i class="fas fa-tachometer-alt"></i>Notification Management
                            </a>

                        </li>
                        <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-copy"></i>New Issue
                            </a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="@Url.Action("MachinBreakdown", "CellEngineer")?lineid=@ViewBag.lineId">Machine Breakdown </a>
                                </li>
                                <li>
                                    <a href="@Url.Action("TechnicalIssue", "CellEngineer")?lineid=@ViewBag.lineId">Technical Issue</a>
                                </li>
                                <li>
                                    <a href="@Url.Action("MaterialDelay", "CellEngineer")?lineid=@ViewBag.lineId">Material Delay</a>
                                </li>
                                <li id="it_drop_mob">
                                    <a href="@Url.Action("ITIssue", "CellEngineer")?lineid=@ViewBag.lineId">Software/IT Issue</a>
                                </li>
                                <li id="qulity_drop_mob">
                                    <a href="@Url.Action("QualityIssue", "CellEngineer")?lineid=@ViewBag.lineId">Quality Issue</a>
                                </li>

                            </ul>
                        </li>
                        <li class="has-sub" id="switchMobile">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-exchange-alt"></i>Switch Lines
                            </a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list"></ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <div class="sub-header-mobile-2 d-block d-lg-none">
            <div class="header__tool">
                <div class="header-button-item has-noti js-item-menu">
                    <i class="zmdi zmdi-notifications"></i>
                    <span class="badge" style="color:orangered;font-size:initial;font-family:'Bodoni MT'" id="cntmobile"></span>
                    <div class="notifi-dropdown notifi-dropdown--no-bor js-dropdown" id="divNotificaionmobile">




                    </div>
                </div>

                <div class="account-wrap">
                    <div class="account-item account-item--style2 clearfix js-item-menu">
                        <div class="image">
                            <img src="~/Content/images/profile.jpg" alt="@Session["name"]" />
                        </div>
                        <div class="content">
                            <a class="js-acc-btn" href="#">@Session["name"]</a>
                        </div>
                        <div class="account-dropdown js-dropdown">
                            <div class="info clearfix">
                                <div class="image">
                                    <a href="#">
                                        <img src="~/Content/images/profile.jpg" alt="@Session["name"]" />
                                    </a>
                                </div>
                                <div class="content">
                                    <h5 class="name">
                                        <a href="#">@Session["name"]</a>
                                    </h5>
                                    <span class="email">@Session["email"]</span>
                                </div>
                            </div>

                            <div class="account-dropdown__footer">
                                <a href="@Url.Action("LogOut","Login")">
                                    <i class="zmdi zmdi-power"></i>Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        @RenderBody()
        <!-- COPYRIGHT-->
        <section class="p-t-60 p-b-20">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="copyright">
                            <p>Copyright © @DateTime.Now.Year - Flintec-IMS Application All rights reserved.</p>

                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- END COPYRIGHT-->
    </div>



    <script src="~/Scripts/Manager/popper.min.js"></script>
    <script src="~/Scripts/Manager/bootstrap.min.js"></script>
    <script src="~/Scripts/slick.min.js"></script>
    <script src="~/Scripts/moment.min.js"></script>
    <script src="~/Scripts/wow.min.js"></script>
    <script src="~/Scripts/animsition.min.js"></script>
    <script src="~/Scripts/bootstrap-progressbar.min.js"></script>



    <script src="~/Scripts/circle-progress.min.js"></script>
    <script src="~/Scripts/perfect-scrollbar.min.js"></script>
    <script src="~/Scripts/Chart.bundle.min.js"></script>
    <script src="~/Scripts/AdminScripts/select2-min.js"></script>
    <script src="~/Scripts/main.js"></script>

    <script src="~/Scripts/jquery.signalR-2.3.0.min.js"></script>
    <script src="~/signalr/Hubs"></script>
    <script src="~/Scripts/jquery-ui.js"></script>


    <script>
         $('#qulity_drop').hide();
         $('#qulity_drop_mob').hide();
        if(('@Session["department"]'=='MachineShop')||('@Session["department"]'=='HeatTreatment')||('@Session["department"]'=='Accessories'))
        {
        $('#it_drop').hide();
        $('#it_drop_mob').hide();
        $('#qulity_drop').show();
         $('#qulity_drop_mob').show();
        }
        $(document).ready(function () {
            // Proxy created on the fly
            var hub = $.connection.myHub;
            // Declare a function on the hub hub so the server can invoke it
            hub.client.displayStatus = function () {
                getData();
            };
            // Start the connection
            $.connection.hub.start();
            getData();
            function getData()
            {   var url = '@Url.Action("GetNotification", "Manager")';
                var divNotificaion = $('#divNotificaion');
                var divNotificaionmobile = $('#divNotificaionmobile');
                $.ajax({
                    url: url,
                    type: 'GET',
                    datatype: 'json',
                    success: function (data) {
                        data = $.parseJSON(data);
                        if (data.length > 0) {
                            divNotificaion.empty();
                            //// set Count
                            var notiCount = 0;
                            for (var i = 0; i < data.length; i++) {
                                if (data[i].EmployeeNumber ==@Session["userID"] && data[i].Status==1) {
                                    var date = data[i].Dates.split(' ');
                                    var day = moment(date[0], 'M/D/Y/').format('MMMM D Y');
                                    if (data[i].Type == 'email') {
                                        var notification = ' <div class="notifi__item" id="' + data[i].NotificationId +'"  onclick="deleteFunction(this)"><div class="bg-c1 img-cir img-40"><i class="zmdi zmdi-email-open"></i></div>' +
                                            ' <div class="content"><p>You have a new email'
                                            + data[i].Message +
                                            '</p> <span class="date">' + day + ' ' + date[1] + ' ' + date[2] + '</span></div></div>'
                                    }
                                    if (data[i].Type == 'issue') {
                                        var notification = ' <div class="notifi__item" id="' + data[i].NotificationId +'" onclick="deleteFunction(this)"><div class="bg-c2 img-cir img-40"><i class="fa fa-gears (alias)"></i></div>' +
                                            ' <div class="content"><p>New issue has been occured'
                                            + data[i].Message +
                                            '</p> <span class="date">' + day + ' ' + date[1] + ' ' + date[2] + '</span></div></div>'
                                    }
                                    divNotificaion.append(notification);
                                    divNotificaionmobile.append(notification);
                                    notiCount++
                                }
                                $('#ntCnt').text(notiCount);
                                $('#cntmobile').text(notiCount);
                            }
                        }
                        if (notiCount == 0) {
                            var notification = '<div class="notifi__footer"><a href="#">No notifications</a> </div>'
                            divNotificaion.append(notification);
                            divNotificaionmobile.append(notification);
                        }
                    }, error: function (r, e, w) {
                    }
                });
            }
        })
        function deleteFunction(div)
        {
            var data = { Issueoccour_Id: $(this).data('issue-occorid'), Issue_Id: $(this).data('issueid') };
            var url = '@Url.Action("hideNotification", "Manager")?notificationId=' + div.id;
            $.post(url)
        }
              var Empid=@Session["userID"]
              var url = '@Url.Action("getCellEngLins", "CellEngineer")';
              var url2 = '@Url.Action("getCellEngLinName", "CellEngineer")';
              var switchLine=document.getElementById("switch");
              var switchMobile=document.getElementById("switchMobile");
              var id=[];
              var lineid;
        $.ajax({
            async:false,
            type: "POST",
            dataType: 'text',
            url: url,
            data: { Empid},
            success: function (linedata) {
             var obj=JSON.parse(linedata);
             for(var i=0;i<obj.length;i++)
             {

                lineid=obj[i].line_id;
                id.push(lineid)
                $.ajax({
                async:false,
                type: "POST",
                dataType: 'text',
                url: url2,
                data: { lineid},
            success: function (linename) {
               setTimeout(function(){
               var obj2=JSON.parse(linename);
               var lineName= obj2[0].line_name
               var idline=id.shift();
                 var urldash ='@Url.Action("DashBord", "CellEngineer")?lineid=' +idline
                 $("#switch ul").append('<li><a id="'+idline+'" href="'+urldash+'"><span class="tab">'+lineName+' Manufacturing Line</span></a></li>');
                 $("#switchMobile ul").append('<li><a id="'+idline+'" href="'+urldash+'"><span class="tab">'+lineName+' Manufacturing Line</span></a></li>');
              }, 1000);

             },
            error: function () {
                alert("Error when get line Name");
            }
            });
            }
            },
            error: function () {
                alert("Error when get Line ID");
            }
            });

    </script>
</body>
</html>

